# ============================================================================
# KITT Backend - Configuration Audio & Transcription
# ============================================================================
# Ce fichier contient tous les param√®tres fonctionnels pour la transcription
# Les secrets (API keys, etc.) restent dans .env

# ============================================================================
# D√âTECTION DE SILENCE
# ============================================================================
silence_detection:
  # -------- AUDIO DU MICROPHONE (COMMERCIAL) --------
  # Le commercial parle directement dans le micro ‚Üí audio g√©n√©ralement plus fort
  # üîç DIAGNOSTIC: Seuils abaiss√©s pour r√©duire la perte de mots
  microphone:
    # Seuil RMS (niveau sonore moyen)
    # Recommandations: 500-700=normal, 700-1000=strict
    # üîß 600.0: R√©duit de 670 pour capturer plus de paroles
    rms_threshold: 800.0

    # Amplitude maximale minimum
    # Recommandations: 1000=standard, 2000=strict
    # üîß 950: R√©duit de 1100 pour capturer les voix plus faibles
    min_amplitude: 950

    # Dur√©e minimale en √©chantillons (~0.18s √† 44100 Hz)
    min_audio_length: 8000

  # -------- AUDIO DU NAVIGATEUR (CLIENT) --------
  # Le client parle via le partage d'√©cran ‚Üí audio souvent plus faible et compress√©
  # ‚ö†Ô∏è IMPORTANT: Seuils augment√©s pour √©viter les hallucinations de Whisper sur le bruit de fond
  # üÜï OPTIMIS√â: Seuils relev√©s pour filtrer plus de bruit AVANT Whisper
  browser:
    # Seuil RMS - √âquilibr√© entre sensibilit√© et filtrage du bruit
    # Recommandations: 300-500=tr√®s sensible, 500-700=sensible, 700+=strict
    # üÜï 600.0: Filtre davantage le bruit de fond qui cause les hallucinations YouTube
    rms_threshold: 680.0

    # Amplitude maximale minimum - Filtrer le bruit de fond
    # Recommandations: 500-700=tr√®s sensible, 800-1200=sensible
    # üÜï 1000: R√©duit les hallucinations sur bruit faible
    min_amplitude: 1000

    # Dur√©e minimale - Ignorer les clips tr√®s courts (bruits)
    # üÜï 10000 (~0.23s): Filtre les clips ultra-courts souvent parasites
    min_audio_length: 10000

# ============================================================================
# WHISPER - TRANSCRIPTION
# ============================================================================
whisper:
  # Langue de transcription
  # Options: "fr", "en", "es", "de", "it", etc.
  # Laisser null pour d√©tection automatique (plus lent)
  language: "fr"

  # Prompt pour aider Whisper √† mieux comprendre le contexte
  # ‚ö†Ô∏è IMPORTANT: Plus le prompt est sp√©cifique avec des exemples de vocabulaire,
  # moins Whisper hallucine. Ajoute des termes techniques ou noms r√©currents.
  # ‚úÖ CORRIG√â: Prompt enrichi avec vocabulaire technique FR/EN pour √©viter "pays de retraite" ‚Üí "pain point"
  prompt: "Appel commercial professionnel. Vocabulaire technique : pain point, lead, prospect, closing, ROI, KPI, SaaS, objection, discovery, pitch, deal, KITT, produit, prix, budget, besoin."

  # Temp√©rature (0.0 = pr√©cis, 1.0 = cr√©atif)
  # Recommandations:
  #   - 0.0: Maximum de pr√©cision mais peut causer des r√©p√©titions ‚ö†Ô∏è
  #   - 0.2-0.3: Bon √©quilibre, r√©duit les hallucinations
  #   - 0.4-0.6: Plus cr√©atif mais moins pr√©cis
  #   - 1.0: Tr√®s cr√©atif, impr√©cis
  # ‚úÖ CORRIG√â: 0.0 pour Z√âRO hallucination (les r√©p√©titions sont pr√©f√©rables aux phrases invent√©es)
  temperature: 0.0

# ============================================================================
# FILTRAGE DES TRANSCRIPTIONS
# ============================================================================
transcription_filtering:
  # Longueur minimale de texte transcrit (en caract√®res)
  # Les transcriptions plus courtes sont rejet√©es
  # Recommandations:
  #   - 1-2: Tr√®s permissif (garde m√™me "oui", "non")
  #   - 3-5: Standard ‚úÖ RECOMMAND√â
  #   - 10+: Strict (ignore les r√©ponses courtes)
  min_length: 3

  # Patterns/mots √† ignorer dans les transcriptions
  # Les transcriptions contenant ces patterns seront rejet√©es
  unwanted_patterns:
    - "sous-titres r√©alis√©s par"
    - "sous-titres par"
    - "amara.org"
    - "merci d'avoir regard√©"
    - "abonnez-vous"
    - "[Musique]"
    - "[musique]"
    - "[Bruit]"
    - "[bruit]"
    - "(bruit de fond)"
    - "(inaudible)"

    # ‚ö†Ô∏è HALLUCINATIONS TYPIQUES DE WHISPER (bruit de fond)
    - "Bonjour √† tous, et bienvenue"
    - "bienvenue dans cette nouvelle vid√©o"
    - "n'oubliez pas de vous abonner"
    - "likez cette vid√©o"
    - "cliquez sur la cloche"
    - "mettez un pouce bleu"
    - "partagez cette vid√©o"
    - "√† tr√®s bient√¥t"
    - "√† la prochaine"
    - "bye bye"

    # üÜï HALLUCINATIONS SUPPL√âMENTAIRES (silence/bruit)
    - "Merci de nous suivre"
    - "N'h√©sitez pas √†"
    - "commentez ci-dessous"
    - "Nous esp√©rons que"
    - "Cette vid√©o vous a plu"
    - "Restez connect√©s"
    - "Rendez-vous"
    - "√Ä tout de suite"
    - "On se retrouve"
    - "Merci pour votre attention"
    - "Je vous invite √† aller voir"
    - "aller voir les vid√©os"
    - "vid√©os de B2B"

    # Ajoutez vos propres patterns ici

# ============================================================================
# PARAM√àTRES AUDIO DE BASE
# ============================================================================
audio:
  # Fr√©quence d'√©chantillonnage (Hz)
  sample_rate: 44100

  # Sous-type d'encodage
  subtype: "PCM_16"

# ============================================================================
# GUIDE DE DIAGNOSTIC
# ============================================================================
#
# PROBL√àME: Le CLIENT (navigateur) ne capte pas les voix
# SOLUTION:
#   1. R√©duire browser.rms_threshold (essayer 300-400)
#   2. R√©duire browser.min_amplitude (essayer 400-500)
#   3. Activer LOG_LEVEL=DEBUG dans .env pour voir les valeurs RMS
#
# PROBL√àME: Le COMMERCIAL (micro) ne capte pas les voix
# SOLUTION:
#   1. R√©duire microphone.rms_threshold (essayer 500-600)
#   2. R√©duire microphone.min_amplitude (essayer 700-800)
#
# PROBL√àME: Trop de bruits de fond du CLIENT / Hallucinations YouTube
# SOLUTION:
#   ‚úÖ D√âJ√Ä OPTIMIS√â: rms_threshold=600, min_amplitude=1000, min_audio_length=10000
#   Si encore trop de bruit:
#   1. Augmenter browser.rms_threshold (essayer 650-700)
#   2. Augmenter browser.min_amplitude (essayer 1100-1200)
#   3. Augmenter browser.min_audio_length (essayer 12000-15000)
#
# PROBL√àME: Trop de bruits de fond du COMMERCIAL
# SOLUTION:
#   1. Augmenter microphone.rms_threshold (essayer 800-900)
#   2. Augmenter microphone.min_amplitude (essayer 1500-2000)
#
# PROBL√àME: Transcriptions impr√©cises
# SOLUTION:
#   1. V√©rifier que language est bien d√©fini ("fr")
#   2. Ajouter un prompt pertinent dans whisper.prompt
#   3. S'assurer que temperature=0.0
#
# PROBL√àME: Transcriptions parasites (sous-titres, musique, etc.)
# SOLUTION:
#   1. Ajouter les patterns dans unwanted_patterns
#   2. Augmenter transcription_filtering.min_length
#
# ============================================================================
# COMPRENDRE LES SEUILS
# ============================================================================
#
# RMS (Root Mean Square) : Niveau sonore MOYEN de l'audio
#   - Valeur basse (300-500) = SENSIBLE (capte m√™me les voix faibles)
#   - Valeur haute (700-1000) = STRICT (ignore les bruits l√©gers)
#
# MIN_AMPLITUDE : Pic de volume MAXIMUM dans l'audio
#   - Valeur basse (500-700) = SENSIBLE
#   - Valeur haute (1500-2000) = STRICT
#
# MIN_AUDIO_LENGTH : Dur√©e minimale en √©chantillons
#   - 4000 = ~0.09 secondes (tr√®s court)
#   - 8000 = ~0.18 secondes (normal)
#   - 22050 = ~0.5 secondes (long)
#
# POURQUOI DEUX CONFIGURATIONS ?
#   - MICROPHONE (commercial) : Audio direct, fort et clair
#   - NAVIGATEUR (client) : Audio compress√©, souvent plus faible
#     ‚Üí N√©cessite des seuils plus sensibles !
